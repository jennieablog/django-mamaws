{% extends 'base.html' %}

{% block content %}

<style>
.servicesContainer{
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 8rem;
    margin-bottom: 8rem;
}

/* HEADER SYLES */
.servicesHeaders{
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding-left: 15rem;
    padding-right: 15rem;
    padding-bottom: 10rem;
}
.mainHeader{
    font-size: 5rem;
    padding-bottom: 5rem;
}
.subHeader{
    font-size: 1.5rem;
    width: 65rem;
}

/* STEP 1 CARD STYLE */
.content1services{
    display: flex;
    padding-bottom: 10rem;
}
.servicesCard1{
    display: flex;
    flex-direction: column;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 20px;
    width: 80rem;
    padding-top: 2.5rem;
    padding-left: 4rem;
    padding-right: 4rem;
    padding-bottom: 6rem;
}
.step1{
    display: flex;
    font-size: 2em;
    font-weight: 900;
    color: #5b5aaa;
    padding-bottom: 2rem;
}
.step1Content{
    display: flex;
    align-items: center;
    justify-content: space-evenly;
}
.step1Content input{
    display: flex;
    border-style: none;
    border-radius: 5px;
    height: 2rem;
    width: 25rem;
    font-size: 1.2em;
    margin-top: 1rem;
    margin-bottom: 1rem;
}
.step1Content label{
    display: flex;
    font-size: 1.5rem;
}

/* SERVICES STYLES */
.content2services{
    display: flex;
    padding-bottom: 10rem;
}
.servicesCard2{
    display: flex;
    flex-direction: column;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 20px;
    width: 80rem;
    padding-top: 2.5rem;
    padding-left: 4rem;
    padding-right: 4rem;
    padding-bottom: 6rem;
}
.step2{
    font-size: 2em;
    font-weight: 900;
    padding-bottom: 2rem;
    color: #5b5aaa;
}
.servicesHeaderContainer{
    display: flex;
    flex-direction: column;
    padding-bottom: 1rem;
}
.servicesHeader{
    font-size: large;
    font-weight: bold;
}
.itemCatalog{
    /* width: 60rem; */
    height: 26rem;
    box-shadow: rgba(0, 0, 0, 0.25) 0px 4px 4px;
    display: grid;
    grid-template-columns: auto auto auto auto;
    justify-content: space-around;
    overflow: auto;
    border-radius: 0.625rem;
    background: rgba(255, 255, 255, 0.35);
    padding: 3rem 3.75rem;
    gap: 5rem;
    margin-bottom: 5rem;
}
.itemCard{
    display: flex;
    flex-direction: column;
    width: 12rem;
    height: 18rem;
    background: rgba(255,255,255,0.5);
    box-shadow: 0px 4px 4px rgb(0 0 0 / 25%);
    border-radius: 0.313rem;
    padding: 0.75rem 0.813rem;
}
.itemImage{
    display: flex;
    height: 10rem;
    width: 10rem;
    background: #D9D9D9;
    align-self: center;
    margin-bottom: 1rem;    
}
.itemImage img{
    height: 10rem;
    width: 10rem; 
}
.itemDetails{
    display: flex;
    flex-direction: column;
}
.itemDetails p{
    padding-bottom: 0.2rem;
    max-height: 1.4rem;
    overflow-x: hidden;
}
.itemDetails div{
    display: flex;
    flex-direction: row;
    justify-content: space-between;
}
/* PERFORMER STYLES */
.performerCatalog{
    /* width: 60rem; */
    height: 16rem;
    box-shadow: rgba(0, 0, 0, 0.25) 0px 4px 4px;
    display: grid;
    grid-template-columns: auto auto;
    justify-content: space-around;
    overflow: auto;
    border-radius: 0.625rem;
    background: rgba(255, 255, 255, 0.35);
    padding: 3rem 3.75rem;
    gap: 5rem;
    margin-bottom: 5rem;
}
.performerCard{
    display: flex;
    /* flex-direction: column; */
    width: 24rem;
    height: 10rem;
    background: rgb(255, 255, 255);
    box-shadow: 0px 4px 4px rgb(0 0 0 / 25%);
    border-radius: 0.313rem;
    justify-content: space-around;
}
.performerImage{
    display: flex;
    width: 7rem;
    height: 7rem;
    background: #D9D9D9;
    align-self: center;
}
.performerImage img{
    height: 7rem;
    width: 7rem; 
}
.performerDetails{
    display: flex;
    flex-direction: column;
    align-self: center;
    width: 12rem;
}
.performerDetails div{
    display: flex;
    flex-direction: row;
    justify-content: space-between;
}
.performerName{
    font-size: 1.2rem;
    font-weight: bold;
}

/* STEP 3 CARD STYLE */
.content3services{
    display: flex;
    flex-direction: column;
    padding-bottom: 10rem;
}
.servicesCard3{
    display: flex;
    flex-direction: column;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 20px;
    width: 80rem;
    padding-top: 2.5rem;
    padding-left: 4rem;
    padding-right: 4rem;
    padding-bottom: 6rem;
}
.step3{
    display: flex;
    font-size: 2em;
    font-weight: 900;
    color: #5b5aaa;
    padding-bottom: 2rem;
}
.leftright{
    display: flex;
    font-size: 1.2em;
    justify-content: center;
}
.left{
    display: flex;
    flex-direction: column;
    background-color: rgba(0, 0, 0, 0.253);
    padding: 4rem;
    border-radius: 25px 0px 0px 25px;
}
.phoneNumber{
    padding-bottom: 1.5rem;
}
.phoneNumber input{
    border-radius: 0.2rem;
    border-width: 0.01rem;
    height: 1.5rem;
}
.left textarea{
    width: 20rem;
    border-radius: 0.3rem;
}
.partySummary{
    font-size: 1.5rem;
    font-weight: bold;
    padding-bottom: 1rem;
}
.right{
    background-color: white;
    display: flex;
    flex-direction: column;
    padding: 4rem;
    width: 30rem;
    border-radius: 0px 25px 25px 0px;
}
.right button{
    padding-top: 0.2rem;
    padding-bottom: 0.2rem;
    margin-top: 1rem;
    height: 2rem;
    width: 100%;
    color: white;
    background-color: rgb(39, 39, 39);
    border-radius: 10rem;
    border-width: 0.1rem;
    border-color: white;
}
.right li{
    font-weight: 600;
}
.mascotsList ul{
    padding-left: 2rem;
}
.servicesList ul{
    padding-left: 2rem;
}
.equipmentsList ul{
    padding-left: 2rem;
}
.performersList ul{
    padding-left: 2rem;
}
.itemName{
    font-weight: bold;
}
</style>


    <form method="post">
        {% csrf_token %}
        <div class="servicesContainer">
            <div class="servicesHeaders">
                <span class="mainHeader">BOOK YOUR PARTY NOW</span>
                <span class="subHeader" id="top">Book a fun and exciting party with Mamaw’s Clown and Party Needs and let the most energetic and spunky children’s birthday entertainers. Make your birthday or special event blast!</span>
            </div>


            <div class="content1services">
                <div class="servicesCard1">
                    <div class="step1">STEP 1: Party Information</div>
                    <div class="step1Content">
                        <div>
                            <label for="id_party_name">Party name*:</label>
                            <input onchange="updateSummary(this);" type="text" id="id_party_name" name="party_name" required>
                            <div class="invalid-feedback">
                                {% for error in form.party_name.errors %}{{ error }}&nbsp;{% endfor %}
                            </div>

                            <label for="id_party_size">Party size*:</label>
                            <input onchange="updateSummary(this);" type="number" id="id_party_size" name="party_size" min="1" max="100" required>
                            <div class="invalid-feedback">
                                {% for error in form.party_size.errors %}{{ error }}&nbsp;{% endfor %}
                            </div>
                            
                            <label for="id_party_date">Party date*:</label>
                            <input onchange="updateSummary(this);" type="date" id="id_party_date" name="party_date" required>
                            <div class="invalid-feedback">
                                {% for error in form.party_date.errors %}{{ error }}&nbsp;{% endfor %}
                            </div>
                        </div>


                        <div>
                            <label for="id_party_start_time">Start time*:</label>
                            <input onchange="updateSummary(this);" type="time" id="id_party_start_time" name="party_start_time" required>
                            <div class="invalid-feedback">
                                {% for error in form.party_start_time.errors %}{{ error }}&nbsp;{% endfor %}
                            </div>

                            <label for="id_party_end_time">End time*:</label>
                            <input onchange="updateSummary(this);" type="time" id="id_party_end_time" name="party_end_time" required>
                            <div class="invalid-feedback">
                                {% for error in form.party_end_time.errors %}{{ error }}&nbsp;{% endfor %}
                            </div>    

                            <div>
                                <label for="id_party_address" required>Party address*:</label>
                                <input onchange="updateSummary(this);" type="text" id="id_party_address" name="party_address" required>
                                <small><a href="#top" onclick="initAutocomplete();">Clear address</a></small>
                            </div>

                            <div class="invalid-feedback">
                                {% for error in form.party_address.errors %}{{ error }}&nbsp;{% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    
            <!-- <br><br> -->
    
            <div class="content2services">
                <div class="servicesCard2">
                    <div class="step2">STEP 2: Party Features</div>
                    
                    <div class="mascotContainer">
                        <div class="servicesHeaderContainer">
                            <span class="servicesHeader">MASCOTS</span>
                            <span>Choose a mascot</span>
                        </div>
                        <div class="itemCatalog">
                            {% for mascot in mascots %}
                            <div class="itemCard">
                                {% if mascot.picture %}
                                <div class="itemImage"><img src="{{ mascot.picture.url }}" alt="{{ mascot.picture.url }}"></div>
                                {% else %}
                                <div class="itemImage"><img src="https://via.placeholder.com/250"></div>
                                {% endif %}
                                <div class="itemDetails">
                                    <p class="itemName">{{ mascot.name }}</p>
                                    <p> {{ mascot.description }}</p>
                                    <div>
                                        <p>Php {{ mascot.price }}</p>
                                        <input onchange="updateListSummary(this);" class="mascot" type="checkbox" id="mascot{{forloop.counter}}" name="mascot{{forloop.counter}}" value="{{ mascot.id }}" data-name="{{ mascot.name }}">
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
    
                    <div class="subServicesContainer">
                        <div class="servicesHeaderContainer">
                            <span class="servicesHeader">SERVICES</span>
                            <span>Choose a service</span>
                        </div>
                        
    
                        <div class="itemCatalog">
                            {% for service in services %}
                            <div class="itemCard">
                                {% if service.picture %}
                                <div class="itemImage"><img src="{{ service.picture.url }}" alt="{{ service.picture.url }}"></div>
                                {% else %}
                                <div class="itemImage"><img src="https://via.placeholder.com/250"></div>
                                {% endif %}
                                <div class="itemDetails">
                                    <p class="itemName">{{ service.name }}</p>
                                    <p> {{ service.description }}</p>
                                    <div>
                                        <p>Php {{ service.price }}</p>
                                        <input onchange="updateListSummary(this);" class="service" type="checkbox" id="service{{forloop.counter}}" name="service{{forloop.counter}}" value="{{ service.id }}" data-name="{{ service.name }}">
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
    
                    <div class="equipmentsContainer">
                        <div class="servicesHeaderContainer">
                            <span class="servicesHeader">EQUIPMENTS</span>
                            <span>Choose party equipments</span>
                        </div>
                        
    
                        <div class="itemCatalog">
                            {% for equipment in equipments %}
                                <div class="itemCard">
                                    {% if equipment.picture %}
                                    <div class="itemImage"><img src="{{ equipment.picture.url }}"></div>
                                    {% else %}
                                    <div class="itemImage"><img src="https://via.placeholder.com/250"></div>
                                    {% endif %}
                                    <div class="itemDetails">
                                        <p class="itemName">{{ equipment.name }}</p>
                                        <p>{{ equipment.description }}</p>
                                        <div>
                                            <p>Php {{ equipment.price }}</p>
                                            <input onchange="updateListSummary(this);" class="equipment" type="checkbox" id="equipment{{forloop.counter}}" name="equipment{{forloop.counter}}" value="{{ equipment.id }}" data-name="{{ equipment.name }}">
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
    
                    <div class="performerContainer">
                        <div class="servicesHeaderContainer">
                            <span class="servicesHeader">PERFORMERS</span>
                            <span>Rent a performer on your party!</span>
                        </div>
                    
                        <div class="performerCatalog">
                            {% for performer in performers %}
                            <div class="performerCard">
                                <input onchange="updateListSummary(this);" class="performer" type="checkbox" id="performer{{forloop.counter}}" name="performer{{forloop.counter}}" value="{{ performer.id }}" data-name="{{ performer.name }}">
                                {% if performer.picture %}
                                <div class="performerImage"><img src="{{ performer.picture.url }}"></div>
                                {% else %}
                                <div class="performerImage"><img src="https://via.placeholder.com/250"></div>
                                {% endif %}
                                <div class="performerDetails">
                                    <span class="performerName">{{ performer.name }}</span>
                                    <div>
                                        <p><a href="#"><em>Click for more details</em></a></p>
                                    </div>
                                    <div>
                                        <p> {{ performer.price }}</p>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
    

            <div class="content3services">
                <div class="servicesCard3">
                    <div class="step3">Step 3: Review and Book</div>

                    <div class="leftright">
                        <div class="left">
                            <div class="phoneNumber">
                                <label for="id_phone_number" required>Phone number*</label><br>
                                <input type="text" id="id_phone_number" name="phone_number" required>
                                <div class="invalid-feedback">
                                    {% for error in form.phone_number.errors %}{{ error }}&nbsp;{% endfor %}
                                </div>
                            </div>
                            <div>
                                <label for="id_notes" required>Party Notes*</label><br>
                                <textarea id="id_notes" name="notes" rows="10" cols="50" required></textarea>
                                <div class="invalid-feedback">
                                    {% for error in form.notes.errors %}{{ error }}&nbsp;{% endfor %}
                                </div>
                            </div>
                        </div>
        
                        <div class="right">
                            <span class="partySummary">Party Summary</span>
                            <hr>
                            <ul>
                                <li>Customer Name: <span style="font-weight:100;">{{ user.name }}</span></li>
                                <li>Email: <span style="font-weight:100;">{{ user.email }}</span></li>
                                <br>
                                <li>Party Name: <span style="font-weight:100;" id="summary_party_name"></span></li>
                                <li>Size: <span style="font-weight:100;" id="summary_party_size"></span></li>
                                <li>Date: <span style="font-weight:100;" id="summary_party_date"></span></li>
                                <li>Address: <span style="font-weight:100;" id="summary_party_address"></span></li><br>
                                <li>Start time: <span style="font-weight:100;" id="summary_party_start_time"></span></li>
                                <li>End time: <span style="font-weight:100;" id="summary_party_end_time"></span></li><br>
                                <hr><br>
                                <li class="mascotsList">Mascots:
                                    <ul id="summary_mascot"></ul>
                                </li><br>
                                <hr><br>
                                <li class="servicesList">Services:
                                    <ul id="summary_service"></ul>
                                </li><br>
                                <hr><br>
                                <li class="equipmentsList">Equipments:
                                    <ul id="summary_equipment"></ul>
                                </li><br>
                                <hr><br>
                                <li class="performersList">Performers:
                                    <ul id="summary_performer"></ul>
                                </li><br>
                            </ul>
                            <button type="submit" id="save-btn" onclick="fillInAddress();">Submit Reservation</button>
                        </div>
                    </div>
                </div>
            </div>       
        </div>

    </form>


{% endblock %}

{% block scripts %}

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-z1LbdTmltBEO__PtdKVTQ6-ZuzvO1XE&callback=initAutocomplete&libraries=places&v=weekly" async></script>
<script>
    function loadSummary() {
        const names = ["party_name", "party_size", "party_date", "party_address","party_start_time", "party_end_time"];
        names.forEach((name)=>{
            let el = document.getElementById('id_' + name);
            updateSummary(el);
        }) 

       var checkboxes = document.querySelectorAll('input[type=checkbox]');
       checkboxes.forEach((checkbox) => {
            updateListSummary(checkbox)
       })
    }

    function updateSummary(el) {
        var summary = 'summary_';
        var name = el.name;
        var value = el.value;
        document.getElementById(summary+name).innerText = el.value;
    }

    function updateListSummary(el) {
        if (el.checked) {
            var parent = document.querySelector('[id=summary_'+el.attributes.class.nodeValue+']')
            var item = document.createElement("li");
            item.setAttribute("id", 'summary_'+el.id);
            item.innerText = el.getAttribute("data-name");
            parent.appendChild(item);
        } else {
            let item = document.querySelector('[id=summary_'+el.id+']')
            if (item != null) {
                item.remove()
            }
        }
    }

    loadSummary();

    let autocomplete;
    let address1Field;
    let address2Field;
    let postalField;
    
    function initAutocomplete() {
        address1Field = document.querySelector("#id_party_address");
        address1Field.value = "";
        address1Field.removeAttribute('readonly');

        // Create the autocomplete object, restricting the search predictions to Philippines
        autocomplete = new google.maps.places.Autocomplete(address1Field, {
            componentRestrictions: { country: [ 'PH' ] },
            fields: ["address_components", "geometry"],
            types: ["address"],
        });
        address1Field.focus();
        
        // When the user selects an address from the drop-down, populate the
        // address fields in the form.
        autocomplete.addListener("place_changed", fillInAddress);
    }
    
    function fillInAddress() {
        if (autocomplete == null) {
            autocomplete = new google.maps.places.Autocomplete(address1Field, {
                componentRestrictions: { country: [ 'PH' ] },
                fields: ["address_components", "geometry"],
                types: ["address"],
            });
        }

        // Get the place details from the autocomplete object.
        var place = autocomplete.getPlace();

        if (place == null || !place.geometry) {
            // User did not select a prediction
            address1Field.setCustomValidity("Please select a valid address.");
        } else {
            document.querySelector("#id_party_address").setAttribute('readonly', 'readonly');
            document.getElementById('summary_party_address').innerText = document.querySelector("#id_party_address").value;
        }
    }
</script>
{% endblock %}
